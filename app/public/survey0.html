<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="css/style.css" />

    <!-- <script src="https://code.jquery.com/jquery.js"></script>-->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"> 
    <script src="main.js"></script>
 
</head>
<body>
        <!-- <script>$("#id01").style.display="none";</script>  -->
    <div id="showAllFriends">

    </div>
    <form>
        <div>
            <div id="surveyName">
                <input type="text" id="name">
            </div>
            <div id="surveyPic">
                    <input type="file"id="pic" accept="image/*">
            </div>
            <div id="survey1">
                <p id="question1">
                    1.Are you interested in blah
                </p>
                <div >
                        <select id="answer1">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                
                        </select>
                </div>      
            </div>  
            <div id="survey2">
                    <p id="question2">
                        2.Are you interested in blah
                    </p>
                    <div >
                            <select id="answer2">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    
                            </select>
                    </div>

            </div>  
            <div id="survey3">
                    <p id="question3">
                        3.Are you interested in blah
                    </p>
                    <div >
                            <select id="answer3">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    
                            </select>
                    </div>

            </div>  
            <div id="survey4">
                    <p id="question4">
                        4.Are you interested in blah
                    </p>
                    <div >
                            <select id="answer4">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                   
                            </select>
                    </div>

            </div>    
            <div id="survey5">
                    <p id="question5">
                        5.Are you interested in blah
                    </p>
                    <div >
                            <select id="answer5">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    
                            </select>
                    </div>

            </div>  
            <div id="survey6">
                    <p id="question6">
                        6.Are you interested in blah
                    </p>
                    <div >
                            <select id="answer6">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    
                            </select>
                    </div>

            </div>  
            <div id="survey7">
                    <p id="question7">
                        7.Are you interested in blah
                    </p>
                    <div >
                            <select id="answer7">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                   
                            </select>
                    </div>

            </div>  
            <div id="survey8">
                    <p id="question8">
                        8.Are you interested in blah
                    </p>
                    <div>
                            <select id="answer8">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    
                            </select>
                    </div>

            </div>
            <div id="survey9">
                    <p id="question9">
                        9.Are you interested in blah
                    </p>
                    <div >
                            <select id="answer9">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                   
                            </select>
                    </div>

            </div>  
            <div id="survey10">
                    <p id="question10">
                        10.Are you interested in blah
                    </p>
                    <div >
                            <select id="answer10">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    
                            </select>
                    </div>

            </div>                     
        </div>
           
        
        
              <div>
                    <button type="submit" id="submitNewFriend">Submit</button>
                    
                    
                    <div id="id01" class="w3-modal">
                <div class="w3-modal-content">
                  <div class="w3-container" id="test">
                    <span onclick="document.getElementById('id01').style.display='none'" class="w3-button w3-display-topright">&times;</span>
                    <div id = "name"><p id="showName"></p></div>
                    <div id = "image"></div>
                  </div>
                </div>
              </div> 
                </div>
    </form>

        <!-- <div id="id01" class="w3-modal">
                <div class="w3-modal-content">
                  <div id ="friendShow" class="w3-container">
                    <span onclick="document.getElementById('id01').style.display='none'" class="w3-button w3-display-topright">&times;</span>
                     <p>Some text. Some text. Some text.</p>
                    <p>Some text. Some text. Some text.</p>
                    <img id="matchesFriend"> 
                  </div>
                </div>
              </div> -->
              
        <div>
            <a href="/api/friends">API Friends</a>
        </div>

        <!-- <div id="resultsModal" class="modal fade" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2 class="modal-title"><strong>Best Match</strong></h2>
                        </div>
                        <div class="modal-body">
                            <h2 id="matchName"></h2>
                            <img id="matchImg" src="" alt="">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div> -->


        <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<!-- </body> -->
<script type="text/javascript">
//   var mymodal=$('#id01');
//  div.style.display = 'none';
//  $("#id01").style.display="none";
// document.getElementById('id01').style.display='none';
 let currentFriends;
    function findFriends(){
        const currentURL = window.location.origin;
        // let currentFriends;
        $.ajax({
            url: currentURL+ "/api/friends",
            method: "GET"
            }).then(function(friendsList){
                console.log(friendsList);
                currentFriends  = friendsList;
                // for(let i=0;i<friendsList.length;i++){
                //     let newDiv = $("<div>");
                //             let newUl = $("<ul>");
                //                     let newLiName = $("<li>");
                //     newLiName.text(friendsList[i].name);
                //     newUl.append(newLiName);
                //     let newLiImage = $("<li>");
                //     let newImage = $("<img>");
                //     newImage.attr("src",friendsList[i].photo);
                //     newImage.attr("width","120");
                //     newImage.attr("length","120");
                //     newLiImage.append(newImage);
                //     newUl.append(newLiImage);
                //     let newLiScores  = $("<li>");
                //     newLiScores.text(friendsList[i].scores);
                //     newUl.append(newLiScores);
                //     newDiv.append(newUl);
                //     $("#showAllFriends").append(newDiv);     
                // }
            });
            console.log("in gety",currentFriends);
            return currentFriends;
    }

   
    $("#submitNewFriend").on("click", function(event){
       
        event.preventDefault(); 
        let newName=$('#name').val().trim();
        let newPic = $('#pic').val();
        let newAnswer1 = parseInt($('#answer1').val());
        let newAnswer2 = parseInt($('#answer2').val());
        let newAnswer3 = parseInt($('#answer3').val());
        let newAnswer4 = parseInt($('#answer4').val());
        let newAnswer5 = parseInt($('#answer5').val());
        let newAnswer6 = parseInt($('#answer6').val());
        let newAnswer7 = parseInt($('#answer7').val());
        let newAnswer8 = parseInt($('#answer8').val());
        let newAnswer9 = parseInt($('#answer9').val());
        let newAnswer10 =parseInt($('#answer10').val());
    
        const newFriend = {
            name:newName,
            photo:newPic,
            scores:[
            newAnswer1,
            newAnswer2,
            newAnswer3,
            newAnswer4,
            newAnswer5,
            newAnswer6,
            newAnswer7,
            newAnswer8,
            newAnswer9,
            newAnswer10
            ]
        };

        console.log(newFriend);

         
        
        // console.log(friendsList);
        $.post("api/friends",newFriend,function(data){
            if(data){
            //     alert("yes");
            // }
            // else{
            //     alert("No");
            // }
            let currentFriends = findFriends();
            console.log("in post",data );
            let sumArr=[];
            for(let i=0;i<currentFriends.length;i++){
                let diff1=Math.abs(newAnswer1-currentFriends[i].scores[1]);
                let diff2=Math.abs(newAnswer2-currentFriends[i].scores[2]);
                let diff3=Math.abs(newAnswer3-currentFriends[i].scores[3]);
                let diff4=Math.abs(newAnswer4-currentFriends[i].scores[4]);
                let diff5=Math.abs(newAnswer5-currentFriends[i].scores[5]);
                let diff6=Math.abs(newAnswer6-currentFriends[i].scores[6]);
                let diff7=Math.abs(newAnswer7-currentFriends[i].scores[7]);
                let diff8=Math.abs(newAnswer8-currentFriends[i].scores[8]);
                let diff9=Math.abs(newAnswer9-currentFriends[i].scores[9]);
                let diff10=Math.abs(newAnswer10-currentFriends[i].scores[10]);
                let sumofDifs=diff1+diff2+diff3+diff4+diff5+diff6+diff7+diff8+diff9+diff10;
                sumArr.push(sumofDifs);
            }
            let index=0;
            for(let i=0;i<currentFriends.length;i++){
                let max=0;
                
                if(sumArr[i]>max){
                    max=sumArr[i];
                    index=i;
                }
            }
            alert(currentFriends[index].name);
            document.getElementById('id01').style.display='block';
            // let divName = $('#name');
            let p = $('#showName');
            p.text(currentFriends[index].name);
            // let newDiv = $("<div>");
            // newDiv.val(currentFriends[index].name);
            // divName.append(newDiv);
            let divImage = $("#image");
            let newImg = $('<img>');
            newImg.attr('src',currentFriends[index].photo);
            newImg.attr('width', '120');
            newImg.attr('length', '120');
            divImage.append(newImg);
            // document.getElementById('id01').style.display='block';
            // let matchesFriend = $('#matchesFriend');
            // matchesFriend.attr('src',currentFriends[index].photo);
           
            // if($('#id01')){
               // $("#id01").style.display = "block";
            // }
            
            // $("#matchName").text(data.name);
            //     $('#matchImg').attr("src", data.photo);
            //     $("#resultsModal").modal('toggle');
            // mpopup.style.display = "block";
        $('#name').val("");
        $('#pic').val("");
        $('#answer1').val("");
        $('#answer2').val("");
        $('#answer3').val("");
        $('#answer4').val("");
        $('#answer5').val("");
        $('#answer6').val("");
        $('#answer7').val("");
        $('#answer8').val("");
        $('#answer9').val("");
        $('#answer10').val("");
    
    }

        


        });
//         var mpopup = document.getElementById('mpopupBox');
// mpopup.style.display = "none";

// var mpLink = document.getElementById("mpopupLink");


// var close = document.getElementsByClassName("close")[0];


// mpLink.onclick = function() {
//     mpopup.style.display = "block";
// }


  // mymodal.style.display = 'block';
        //     let divFriendShow = $('#friendShow');
        //     let divName = $('<div>');
        //     divName.val(currentFriends[index].name);
        //     divFriendShow.append(divName);
        //     let friendImg = $('<img>');
        //     friendImg.attr('src',currentFriends[index]);
        //     divFriendShow.append(friendImg);
    });
      


// close.onclick = function() {
//     mpopup.style.display = "none";
// }


// window.onclick = function(event) {
//     if (event.target == mpopup) {
//         mpopup.style.display = "none";
//     }
// }

      


    findFriends();

</script>
</body>
</html>